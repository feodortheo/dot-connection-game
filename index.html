


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dot Connection Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection@0.4/face_detection.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .dots-container {
            position: relative;
            width: 90vw;
            max-width: 600px;
            height: 200px;
            margin-bottom: 50px;
        }

        .dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #ff69b4;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.5s ease;
            box-shadow: 0 0 15px rgba(255, 105, 180, 1), 0 0 30px rgba(255, 105, 180, 0.6);
            z-index: 5;
            border: 2px solid #fff;
        }

        .dot1 {
            /* Position will be set by JavaScript */
        }

        .dot2 {
            /* Position will be set by JavaScript */
        }

        .root {
            position: absolute;
            height: 3px;
            background-color: #ff69b4;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.5s ease;
            box-shadow: 0 0 5px rgba(255, 105, 180, 0.6);
            z-index: 1;
        }

        .root.initial {
            left: 70px;
            right: 70px;
        }

        .root.correct {
            left: 50%;
            right: 50%;
            transform: translateY(-50%) translateX(-50%);
            width: 0;
        }

        .root.incorrect {
            left: 25%;
            right: 25%;
        }

        .buttons {
            display: flex;
            gap: 30px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 18px;
            border: 2px solid #ff69b4;
            background-color: transparent;
            color: #ff69b4;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #ff69b4;
            color: #000;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .victory-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: transparent;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .victory-text {
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            position: absolute;
            pointer-events: none;
            z-index: 1001;
            will-change: transform, opacity;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        .victory-text.love {
            /* Animation will be set inline for immediate start */
        }

        @keyframes flyAround {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(100vw, -50vh) rotate(90deg);
            }
            50% {
                transform: translate(50vw, 100vh) rotate(180deg);
            }
            75% {
                transform: translate(-50vw, 50vh) rotate(270deg);
            }
            100% {
                transform: translate(0, 0) rotate(360deg);
            }
        }

        @keyframes flyDiagonal {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            50% {
                transform: translate(100vw, 100vh) rotate(180deg);
            }
            100% {
                transform: translate(0, 0) rotate(360deg);
            }
        }

        @keyframes flyHorizontal {
            0% {
                transform: translate(-100px, 0) rotate(0deg);
            }
            50% {
                transform: translate(calc(100vw + 100px), 0) rotate(180deg);
            }
            100% {
                transform: translate(-100px, 0) rotate(360deg);
            }
        }

        @keyframes flyVertical {
            0% {
                transform: translate(0, -100px) rotate(0deg);
            }
            50% {
                transform: translate(0, calc(100vh + 100px)) rotate(180deg);
            }
            100% {
                transform: translate(0, -100px) rotate(360deg);
            }
        }

        @keyframes fallDown {
            0% {
                transform: translateY(-200px) rotate(0deg);
                opacity: 1;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 200px)) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes fontPulse {
            0% {
                font-size: inherit;
                text-shadow: 0 0 20px #ff69b4;
            }
            50% {
                font-size: 1.3em;
                text-shadow: 0 0 30px #ff69b4, 0 0 40px #ff69b4;
            }
            100% {
                font-size: inherit;
                text-shadow: 0 0 20px #ff69b4;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .heart {
            position: absolute;
            color: #ff69b4;
            font-size: 24px;
            animation: fall 4s linear infinite;
            pointer-events: none;
            text-shadow: 0 0 10px #ff69b4;
            filter: drop-shadow(0 0 5px rgba(255, 105, 180, 0.8));
            z-index: 999;
            will-change: transform, opacity;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .restart-btn {
            padding: 15px 30px;
            font-size: 18px;
            border: 2px solid #ff69b4;
            background-color: #ff69b4;
            color: #fff;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
            margin-top: 20px;
            text-shadow: 0 0 10px #fff;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5), 0 0 40px rgba(255, 105, 180, 0.3), 0 0 60px rgba(255, 105, 180, 0.1);
            animation: buttonGlow 2s ease-in-out infinite alternate;
            z-index: 10000;
            position: relative;
        }

        .restart-btn:hover {
            background-color: #ff1493;
            color: #fff;
            text-shadow: 0 0 15px #fff;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.8), 0 0 60px rgba(255, 20, 147, 0.5), 0 0 90px rgba(255, 20, 147, 0.3);
            transform: scale(1.05);
        }

        .photo-upload-section {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff69b4;
            z-index: 100;
        }

        .photo-upload-section h3 {
            color: #ff69b4;
            margin-bottom: 15px;
            text-align: center;
        }

        .photo-input-group {
            margin-bottom: 15px;
        }

        .photo-input-group label {
            color: #ff69b4;
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .photo-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ff69b4;
            border-radius: 5px;
            background-color: transparent;
            color: #ff69b4;
            font-size: 12px;
        }

        .upload-btn {
            width: 100%;
            padding: 10px;
            background-color: #ff69b4;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background-color: #ff1493;
            transform: scale(1.05);
        }

        .upload-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .person-photo {
            position: absolute;
            width: 100px;
            height: 100px;
            object-fit: cover;
            object-position: center center;
            border: 3px solid #ff69b4;
            border-radius: 50%;
            transition: all 0.5s ease;
            z-index: 10;
        }

        @keyframes headGlow {
            0% {
                filter: drop-shadow(0 0 5px #ff69b4);
            }
            100% {
                filter: drop-shadow(0 0 15px #ff69b4) drop-shadow(0 0 25px rgba(255, 105, 180, 0.5));
            }
        }

        .person-photo.dot1-photo {
            top: -110px;
            left: -50px;
            position: absolute;
            transform: translateZ(0);
        }

        .person-photo.dot2-photo {
            top: -110px;
            right: -50px;
            position: absolute;
            transform: translateZ(0);
        }

        .processing-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .processing-container {
            background-color: #000;
            border: 2px solid #ff69b4;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
        }

        .processing-text {
            color: #ff69b4;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #ff69b4;
            border-top: 4px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Welcome Screen */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .welcome-text {
            font-size: 32px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            margin-bottom: 30px;
            text-align: center;
            animation: welcomePulse 2s ease-in-out infinite;
            line-height: 1.4;
        }

        .welcome-subtitle {
            font-size: 32px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.4;
        }

        .welcome-button {
            background-color: #ff69b4;
            color: #fff;
            border: none;
            border-radius: 15px;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.3);
        }

        .welcome-button:hover {
            background-color: #ff1493;
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.5);
        }

        @keyframes welcomePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .butterfly {
            width: 120px;
            height: 80px;
            cursor: pointer;
            animation: butterflyFlyAround 8s ease-in-out infinite;
            transition: all 0.3s ease;
            position: absolute;
            z-index: 1001;
        }

        .butterfly:hover {
            transform: scale(1.1);
        }

        /* Butterfly body */
        .butterfly::before {
            content: '';
            position: absolute;
            width: 6px;
            height: 60px;
            background: linear-gradient(to bottom, #8B4513, #A0522D, #8B4513);
            border-radius: 3px;
            left: 50%;
            top: 10px;
            transform: translateX(-50%);
            box-shadow: 
                0 0 10px rgba(139, 69, 19, 0.5),
                inset 0 0 5px rgba(255, 255, 255, 0.2);
        }

        /* Left wing */
        .butterfly::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 35px;
            background: 
                radial-gradient(circle at 30% 30%, #ff69b4, #ff1493),
                radial-gradient(circle at 70% 20%, #ffc0cb, #ff69b4),
                radial-gradient(circle at 20% 70%, #ff1493, #ff69b4),
                linear-gradient(45deg, #ff69b4, #ff1493, #ff69b4);
            border-radius: 50% 20% 50% 20%;
            left: 0;
            top: 15px;
            transform: rotate(-15deg);
            box-shadow: 
                0 0 15px rgba(255, 105, 180, 0.6),
                inset 0 0 10px rgba(255, 255, 255, 0.3),
                0 0 5px rgba(255, 20, 147, 0.4);
        }

        /* Right wing - using a separate element */
        .butterfly .right-wing {
            position: absolute;
            width: 50px;
            height: 35px;
            background: 
                radial-gradient(circle at 30% 30%, #ff69b4, #ff1493),
                radial-gradient(circle at 70% 20%, #ffc0cb, #ff69b4),
                radial-gradient(circle at 20% 70%, #ff1493, #ff69b4),
                linear-gradient(-45deg, #ff69b4, #ff1493, #ff69b4);
            border-radius: 20% 50% 20% 50%;
            right: 0;
            top: 15px;
            transform: rotate(15deg);
            box-shadow: 
                0 0 15px rgba(255, 105, 180, 0.6),
                inset 0 0 10px rgba(255, 255, 255, 0.3),
                0 0 5px rgba(255, 20, 147, 0.4);
        }

        /* Wing patterns */
        .butterfly .wing-pattern {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #fff, #ffc0cb);
            border-radius: 50%;
            top: 20px;
            left: 15px;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        }

        .butterfly .wing-pattern:nth-child(2) {
            top: 35px;
            left: 25px;
            width: 6px;
            height: 6px;
        }

        .butterfly .wing-pattern:nth-child(3) {
            top: 25px;
            right: 15px;
            left: auto;
        }

        .butterfly .wing-pattern:nth-child(4) {
            top: 40px;
            right: 25px;
            left: auto;
            width: 6px;
            height: 6px;
        }

        @keyframes butterflyFlyAround {
            0% {
                transform: translate(0vw, 0vh) rotate(0deg);
            }
            12.5% {
                transform: translate(20vw, -10vh) rotate(45deg);
            }
            25% {
                transform: translate(40vw, 5vh) rotate(90deg);
            }
            37.5% {
                transform: translate(60vw, -15vh) rotate(135deg);
            }
            50% {
                transform: translate(80vw, 10vh) rotate(180deg);
            }
            62.5% {
                transform: translate(60vw, 30vh) rotate(225deg);
            }
            75% {
                transform: translate(40vw, 50vh) rotate(270deg);
            }
            87.5% {
                transform: translate(20vw, 30vh) rotate(315deg);
            }
            100% {
                transform: translate(0vw, 0vh) rotate(360deg);
            }
        }

        /* Kissing Screen */
        .kissing-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .kissing-text {
            font-size: 32px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.4;
        }

        .kissing-subtitle {
            font-size: 32px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.4;
        }

        /* Fighter Selection Screen */
        .fighter-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .fighter-title {
            font-size: 42px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            margin-bottom: 40px;
            text-align: center;
        }

        .fighter-upload-section {
            background-color: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #ff69b4;
            max-width: 500px;
            width: 90%;
        }

        .fighter-upload-section h3 {
            color: #ff69b4;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .fighter-input-group {
            margin-bottom: 20px;
        }

        .fighter-input-group label {
            color: #ff69b4;
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .fighter-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff69b4;
            border-radius: 8px;
            background-color: transparent;
            color: #ff69b4;
            font-size: 14px;
        }

        .fighter-name-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff69b4;
            border-radius: 8px;
            background-color: transparent;
            color: #ff69b4;
            font-size: 14px;
            margin-top: 8px;
        }

        .fighter-upload-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 20px;
        }

        .fighter-upload-row .fighter-input-group {
            flex: 1;
            margin-bottom: 0;
        }


        .start-game-btn {
            width: 100%;
            padding: 15px;
            background-color: #ff69b4;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .start-game-btn:hover {
            background-color: #ff1493;
            transform: scale(1.05);
        }

        .start-game-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        /* Mobile responsive styles */
        @media (max-width: 768px) {
            .dots-container {
                width: 95vw;
                height: 150px;
                margin-bottom: 30px;
            }
            
            .dot {
                width: 18px;
                height: 18px;
            }
            
            .person-photo {
                width: 60px;
                height: 60px;
            }
            
            .person-photo.dot1-photo {
                top: -90px;
                left: -40px;
            }
            
            .person-photo.dot2-photo {
                top: -90px;
                right: -40px;
            }
            
            .welcome-text, .welcome-subtitle, .kissing-text, .kissing-subtitle {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .fighter-title {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .question-header {
                font-size: 20px;
                top: 40px;
            }
            
            .question-display {
                top: 100px;
                font-size: 16px;
                padding: 15px 20px;
                max-width: 90%;
            }
            
            .welcome-button, .start-game-btn {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            /* Statistics screen mobile styles */
            .stats-title {
                font-size: 28px;
                margin-bottom: 30px;
            }
            
            .stats-container {
                gap: 40px;
                flex-direction: column;
            }
            
            .player-photo-stat {
                width: 120px;
                height: 120px;
            }
            
            .player-name-stat {
                font-size: 20px;
            }
            
            .player-percentage {
                font-size: 28px;
            }
            
            .player-details {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .dots-container {
                width: 98vw;
                height: 120px;
                margin-bottom: 20px;
            }
            
            .dot {
                width: 16px;
                height: 16px;
            }
            
            .person-photo {
                width: 50px;
                height: 50px;
            }
            
            .person-photo.dot1-photo {
                top: -75px;
                left: -35px;
            }
            
            .person-photo.dot2-photo {
                top: -75px;
                right: -35px;
            }
            
            .welcome-text, .welcome-subtitle, .kissing-text, .kissing-subtitle {
                font-size: 20px;
                margin-bottom: 15px;
            }
            
            .fighter-title {
                font-size: 20px;
                margin-bottom: 15px;
            }
            
            .question-header {
                font-size: 18px;
                top: 30px;
            }
            
            .question-display {
                top: 80px;
                font-size: 14px;
                padding: 12px 15px;
                max-width: 95%;
            }
            
            /* Statistics screen small mobile styles */
            .stats-title {
                font-size: 24px;
                margin-bottom: 25px;
            }
            
            .stats-container {
                gap: 30px;
            }
            
            .player-photo-stat {
                width: 100px;
                height: 100px;
            }
            
            .player-name-stat {
                font-size: 18px;
            }
            
            .player-percentage {
                font-size: 24px;
            }
            
            .player-details {
                font-size: 12px;
            }
        }

        /* Landscape mobile styles */
        @media (max-height: 500px) and (orientation: landscape) {
            .dots-container {
                height: 100px;
                margin-bottom: 20px;
            }
            
            .person-photo {
                width: 40px;
                height: 40px;
            }
            
            .person-photo.dot1-photo {
                top: -60px;
                left: -30px;
            }
            
            .person-photo.dot2-photo {
                top: -60px;
                right: -30px;
            }
            
            .welcome-text, .welcome-subtitle, .kissing-text, .kissing-subtitle {
                font-size: 18px;
                margin-bottom: 10px;
            }
            
            .question-header {
                font-size: 16px;
                top: 20px;
            }
            
            .question-display {
                top: 60px;
                font-size: 12px;
                padding: 8px 12px;
            }
        }

        /* Game Screen */
        .game-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .question-header {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            color: #ff69b4;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 15px #ff69b4;
            z-index: 1001;
            opacity: 1;
        }

        .question-header.fade-out {
            animation: fadeOut 1s ease-out forwards;
            animation-fill-mode: forwards;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        .question-display {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: #ff69b4;
            padding: 20px 30px;
            border-radius: 15px;
            border: 2px solid #ff69b4;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            max-width: 80%;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.3);
            z-index: 1001;
        }

        /* Answer feedback animations */
        .answer-heart {
            position: absolute;
            font-size: 40px;
            color: #ff69b4;
            pointer-events: none;
            z-index: 1002;
            animation: heartFloat 2s ease-out forwards;
        }

        .answer-broken-heart {
            position: absolute;
            font-size: 40px;
            color: #ff69b4;
            pointer-events: none;
            z-index: 1002;
            animation: brokenHeartFall 2s ease-out forwards;
        }

        @keyframes heartFloat {
            0% {
                opacity: 1;
                transform: translateY(0px) scale(1);
            }
            50% {
                opacity: 1;
                transform: translateY(-30px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(0.8);
            }
        }

        @keyframes brokenHeartFall {
            0% {
                opacity: 1;
                transform: translateY(0px) rotate(0deg) scale(1);
            }
            50% {
                opacity: 1;
                transform: translateY(20px) rotate(10deg) scale(1.1);
            }
            100% {
                opacity: 0;
                transform: translateY(60px) rotate(20deg) scale(0.6);
            }
        }

        /* Kiss animations */
        .kiss-animation {
            position: absolute;
            font-size: 30px;
            color: #ff69b4;
            pointer-events: none;
            z-index: 1002;
            animation: kissFloat 3s ease-out forwards;
        }

        @keyframes kissFloat {
            0% {
                opacity: 1;
                transform: translateY(0px) scale(1) rotate(0deg);
            }
            25% {
                opacity: 1;
                transform: translateY(-20px) scale(1.2) rotate(10deg);
            }
            50% {
                opacity: 1;
                transform: translateY(-40px) scale(1.1) rotate(-5deg);
            }
            75% {
                opacity: 0.7;
                transform: translateY(-60px) scale(0.9) rotate(15deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(0.7) rotate(25deg);
            }
        }

        .question-mark-animation {
            font-size: 30px;
            color: #ff69b4;
            position: absolute;
            pointer-events: none;
            z-index: 1002;
            animation: questionMarkFloat 2s ease-out forwards;
        }

        @keyframes questionMarkFloat {
            0% {
                opacity: 1;
                transform: translateY(0px) scale(1) rotate(0deg);
            }
            25% {
                opacity: 1;
                transform: translateY(-20px) scale(1.2) rotate(10deg);
            }
            50% {
                opacity: 1;
                transform: translateY(-40px) scale(1.1) rotate(-5deg);
            }
            75% {
                opacity: 0.7;
                transform: translateY(-60px) scale(0.9) rotate(15deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(0.7) rotate(25deg);
            }
        }

        /* Background Music */
        #backgroundMusic {
            display: none;
        }

        /* Music Player */
        .music-player {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 25px;
            padding: 8px;
            z-index: 2000;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            overflow: hidden;
            width: 50px;
            height: 50px;
        }

        .music-player:hover {
            width: auto;
            height: auto;
            padding: 10px;
        }

        .music-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            color: #ff69b4;
            transition: all 0.3s ease;
        }

        .music-player:hover .music-icon {
            opacity: 0;
        }

        .music-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .music-player:hover .music-controls {
            opacity: 1;
        }

        .music-btn {
            background: #ff69b4;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-btn:hover {
            background: #ff1493;
            transform: scale(1.1);
        }

        .track-info {
            display: flex;
            flex-direction: column;
            margin-left: 8px;
            color: white;
            font-size: 12px;
            min-width: 100px;
        }

        #trackTitle {
            font-weight: bold;
            color: #ff69b4;
        }

        #trackNumber {
            font-size: 10px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .music-player {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
            
            .music-icon {
                font-size: 28px;
            }
            
            .music-btn {
                width: 30px;
                height: 30px;
                font-size: 12px;
            }
            
            .track-info {
                font-size: 10px;
                min-width: 80px;
            }
            
            #trackNumber {
                font-size: 9px;
            }
        }

        /* End Screen */
        .end-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .end-text {
            font-size: 36px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            margin-bottom: 30px;
            text-align: center;
        }

        /* Statistics Screen */
        .stats-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .stats-title {
            font-size: 42px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 20px #ff69b4;
            margin-bottom: 50px;
            text-align: center;
        }

        .stats-container {
            display: flex;
            gap: 80px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .player-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .player-photo-stat {
            width: 150px;
            height: 150px;
            object-fit: cover;
            object-position: center center;
            border: 4px solid #ff69b4;
            border-radius: 50%;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.5);
            animation: headGlow 2s ease-in-out infinite alternate;
        }

        .player-name-stat {
            font-size: 24px;
            color: #ff69b4;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #ff69b4;
        }

        .player-percentage {
            font-size: 36px;
            color: #ff69b4;
            font-weight: bold;
            text-shadow: 0 0 15px #ff69b4;
            margin-bottom: 10px;
        }

        .player-details {
            font-size: 16px;
            color: #ff69b4;
            opacity: 0.8;
        }

        .stats-restart-btn {
            margin-top: 50px;
        }

        @keyframes buttonGlow {
            0% {
                box-shadow: 0 0 20px rgba(255, 105, 180, 0.5), 0 0 40px rgba(255, 105, 180, 0.3), 0 0 60px rgba(255, 105, 180, 0.1);
                text-shadow: 0 0 10px #fff;
            }
            100% {
                box-shadow: 0 0 30px rgba(255, 105, 180, 0.7), 0 0 60px rgba(255, 105, 180, 0.4), 0 0 90px rgba(255, 105, 180, 0.2);
                text-shadow: 0 0 15px #fff, 0 0 25px #fff;
            }
        }
        
        /* AI Settings */
        .ai-settings-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 255, 255, 0.9);
            border: none;
            border-radius: 25px;
            padding: 10px 15px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .ai-settings-btn:hover {
            background: rgba(0, 255, 255, 1);
            transform: scale(1.05);
        }
        
        .ai-settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ffff;
            border-radius: 20px;
            padding: 30px;
            z-index: 2000;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
            max-width: 500px;
            width: 90%;
        }
        
        .ai-settings-content h3 {
            color: #00ffff;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .ai-settings-content p {
            color: #fff;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .api-key-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #00ffff;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .api-key-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .ai-settings-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .ai-btn {
            background: #00ffff;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ai-btn:hover {
            background: #00cccc;
            transform: scale(1.05);
        }
        
        .declension-test {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid #00ffff;
        }
        
        .declension-test h4 {
            color: #00ffff;
            margin-bottom: 15px;
        }
        
        .test-name-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #00ffff;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .test-results {
            color: #fff;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .test-results strong {
            color: #00ffff;
        }
    </style>
</head>
<body>
    <!-- Background Music -->
    <audio id="backgroundMusic" loop preload="auto">
        <source src="https://www.bensound.com/bensound-music/bensound-pianomoment.mp3" type="audio/mpeg">
        <source src="https://www.bensound.com/bensound-music/bensound-pianomoment.ogg" type="audio/ogg">
        Your browser does not support the audio element.
    </audio>
    
    <!-- Music Player -->
    <div id="musicPlayer" class="music-player">
        <div class="music-icon">‚ô™</div>
        <div class="music-controls">
            <button id="prevTrack" class="music-btn">‚èÆ</button>
            <button id="playPause" class="music-btn">‚ñ∂</button>
            <button id="nextTrack" class="music-btn">‚è≠</button>
            <div class="track-info">
                <span id="trackTitle">–ú–æ–º–µ–Ω—Ç –ø–∏–∞–Ω–∏–Ω–æ</span>
            </div>
        </div>
    </div>
    
    <!-- AI Settings Panel -->
    <div id="aiSettingsPanel" class="ai-settings-panel" style="display: none;">
        <div class="ai-settings-content">
            <h3>ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ò–ò –¥–ª—è —Å–∫–ª–æ–Ω–µ–Ω–∏—è –∏–º–µ–Ω</h3>
            <p>–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ò–ò-—Å–∫–ª–æ–Ω–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à OpenAI API –∫–ª—é—á:</p>
            <input type="password" id="openaiApiKey" placeholder="sk-..." class="api-key-input">
            <div class="ai-settings-buttons">
                <button id="saveApiKey" class="ai-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="testDeclension" class="ai-btn">–¢–µ—Å—Ç —Å–∫–ª–æ–Ω–µ–Ω–∏—è</button>
                <button id="closeAiSettings" class="ai-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            <div id="declensionTest" class="declension-test" style="display: none;">
                <h4>–¢–µ—Å—Ç —Å–∫–ª–æ–Ω–µ–Ω–∏—è:</h4>
                <input type="text" id="testName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è —Ç–µ—Å—Ç–∞" class="test-name-input">
                <div id="testResults" class="test-results"></div>
            </div>
        </div>
    </div>
    
    <!-- AI Settings Button -->
    <button id="aiSettingsBtn" class="ai-settings-btn">ü§ñ –ò–ò</button>
    
    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-text">–ø—Ä–∏–≤–µ—Ç, –¥–æ—Ä–æ–≥—É—à–∏</div>
        <div class="welcome-subtitle">—è —Å–¥–µ–ª–∞–ª –∏–≥—Ä—É, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –≤—ã –∑–Ω–∞–µ—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞</div>
        <div class="welcome-subtitle">–≥–æ—Ç–æ–≤—ã?</div>
        <button class="welcome-button" onclick="showKissingScreenWithHearts()">–¥–∞</button>
    </div>

    <!-- Kissing Screen -->
    <div class="kissing-screen" id="kissingScreen">
        <div class="kissing-text" id="kissingText">–¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø–æ—Ü–µ–ª–æ–≤–∞—Ç—å—Å—è</div>
        <button class="welcome-button" id="kissButton" onclick="showQuestionAndButton()">–º—ã –ø–æ—Ü–µ–ª–æ–≤–∞–ª–∏—Å—å</button>
    </div>

    <!-- Fighter Selection Screen -->
    <div class="fighter-screen" id="fighterScreen">
        <div class="fighter-title">–≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–∏—Ö –±–æ–π—Ü–æ–≤</div>
        <div class="fighter-upload-section">
            <div class="fighter-upload-row">
                <div class="fighter-input-group">
                    <label for="fighter1">–ë–æ–µ—Ü 1:</label>
                    <input type="file" id="fighter1" class="fighter-input" accept="image/*" onchange="handleFighterUpload(1, this)">
                    <input type="text" id="name1" class="fighter-name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" onchange="updateFighterName(1, this)">
                </div>
                <div class="fighter-input-group">
                    <label for="fighter2">–ë–æ–µ—Ü 2:</label>
                    <input type="file" id="fighter2" class="fighter-input" accept="image/*" onchange="handleFighterUpload(2, this)">
                    <input type="text" id="name2" class="fighter-name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" onchange="updateFighterName(2, this)">
                </div>
            </div>
            <button class="start-game-btn" onclick="beginGame()" id="startGameBtn" disabled>–í–≤–µ–¥–∏—Ç–µ –∏–º–µ–Ω–∞ –æ–±–æ–∏—Ö –±–æ–π—Ü–æ–≤</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="game-screen" id="gameScreen">
        <div class="question-header" id="questionHeader"></div>
        <div class="question-display" id="questionDisplay"></div>
        <div class="container">
            <div class="dots-container">
                <div class="dot dot1">
                    <img id="person1" class="person-photo dot1-photo" style="display: none;" alt="Person 1">
                </div>
                <div class="dot dot2">
                    <img id="person2" class="person-photo dot2-photo" style="display: none;" alt="Person 2">
                </div>
                <div class="root initial"></div>
            </div>
            
            <div class="buttons">
                <button class="btn" onclick="moveDots('correct')">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</button>
                <button class="btn" onclick="moveDots('incorrect')">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</button>
            </div>
        </div>
    </div>

    <!-- End Screen -->
    <div class="end-screen" id="endScreen">
        <div class="end-text">–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</div>
        <button class="restart-btn" onclick="restartFromBeginning()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <!-- Victory Screen -->
    <div class="victory-screen" id="victoryScreen">
        <button class="restart-btn" onclick="showStatsScreen()">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
    </div>

    <!-- Statistics Screen -->
    <div class="stats-screen" id="statsScreen">
        <div class="stats-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤</div>
        <div class="stats-container">
            <div class="player-stat">
                <img id="player1StatPhoto" class="player-photo-stat" alt="Player 1">
                <div id="player1StatName" class="player-name-stat"></div>
                <div id="player1StatPercentage" class="player-percentage"></div>
                <div id="player1StatDetails" class="player-details"></div>
            </div>
            <div class="player-stat">
                <img id="player2StatPhoto" class="player-photo-stat" alt="Player 2">
                <div id="player2StatName" class="player-name-stat"></div>
                <div id="player2StatPercentage" class="player-percentage"></div>
                <div id="player2StatDetails" class="player-details"></div>
            </div>
        </div>
        <button class="restart-btn stats-restart-btn" onclick="restartFromBeginning()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <!-- Processing Modal -->
    <div class="processing-modal" id="processingModal">
        <div class="processing-container">
            <div class="processing-spinner"></div>
            <div class="processing-text" id="processingText">–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ª–∏—Ü...</div>
        </div>
    </div>

    <script>
        // Background Music Setup
        document.addEventListener('DOMContentLoaded', function() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            const playPauseBtn = document.getElementById('playPause');
            const prevTrackBtn = document.getElementById('prevTrack');
            const nextTrackBtn = document.getElementById('nextTrack');
            const trackTitle = document.getElementById('trackTitle');
            
            // 50 romantic and relaxing music tracks
            const musicTracks = [
                { title: "–ú–æ–º–µ–Ω—Ç –ø–∏–∞–Ω–∏–Ω–æ", url: "https://www.bensound.com/bensound-music/bensound-pianomoment.mp3" },
                { title: "–ú–∏—Ä–Ω—ã–π —Ä–∞–∑—É–º", url: "https://www.bensound.com/bensound-music/bensound-peaceful.mp3" },
                { title: "–ù–µ–∂–Ω—ã–π –≤–µ—Ç–µ—Ä–æ–∫", url: "https://www.bensound.com/bensound-music/bensound-gentle.mp3" },
                { title: "–°–ª–∞–¥–∫–∏–µ —Å–Ω—ã", url: "https://www.bensound.com/bensound-music/bensound-sweet.mp3" },
                { title: "–ù–µ–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã", url: "https://www.bensound.com/bensound-music/bensound-tender.mp3" },
                { title: "–¢–∏—Ö–∏–π —à—ë–ø–æ—Ç", url: "https://www.bensound.com/bensound-music/bensound-soft.mp3" },
                { title: "–°—Ç—Ä—É–Ω—ã —Å–µ—Ä–¥—Ü–∞", url: "https://www.bensound.com/bensound-music/bensound-heart.mp3" },
                { title: "–õ—É–Ω–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-moonlight.mp3" },
                { title: "–û–∫–µ–∞–Ω—Å–∫–∞—è –±–µ–∑–º—è—Ç–µ–∂–Ω–æ—Å—Ç—å", url: "https://www.bensound.com/bensound-music/bensound-ocean.mp3" },
                { title: "–õ–µ—Å–Ω–∞—è –≥–∞—Ä–º–æ–Ω–∏—è", url: "https://www.bensound.com/bensound-music/bensound-forest.mp3" },
                { title: "–£—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–¥–æ—Å—Ç—å", url: "https://www.bensound.com/bensound-music/bensound-morning.mp3" },
                { title: "–í–µ—á–µ—Ä–Ω—è—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-evening.mp3" },
                { title: "–í–µ—Å–µ–Ω–Ω—è—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-summer.mp3" },
                { title: "–ó–æ–ª–æ—Ç–∞—è –æ—Å–µ–Ω—å", url: "https://www.bensound.com/bensound-music/bensound-autumn.mp3" },
                { title: "–ó–∏–º–Ω–µ–µ —á—É–¥–æ", url: "https://www.bensound.com/bensound-music/bensound-winter.mp3" },
                { title: "–ö—Ä–∏—Å—Ç–∞–ª—å–Ω–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-crystal.mp3" },
                { title: "–ó–æ–ª–æ—Ç–æ–π —á–∞—Å", url: "https://www.bensound.com/bensound-music/bensound-golden.mp3" },
                { title: "–°–µ—Ä–µ–±—Ä—è–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-silver.mp3" },
                { title: "–ì–æ–ª—É–±–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-blue.mp3" },
                { title: "–ó–µ–ª—ë–Ω—ã–π —Ä–∞–π", url: "https://www.bensound.com/bensound-music/bensound-green.mp3" },
                { title: "–ë–µ–ª–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-white.mp3" },
                { title: "–≠–ª–µ–≥–∞–Ω—Ç–Ω–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-black.mp3" },
                { title: "–†–æ–∑–æ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-pink.mp3" },
                { title: "–û—Ä–∞–Ω–∂–µ–≤–∞—è —Ä–∞–¥–æ—Å—Ç—å", url: "https://www.bensound.com/bensound-music/bensound-orange.mp3" },
                { title: "–ñ—ë–ª—Ç–æ–µ —Å—á–∞—Å—Ç—å–µ", url: "https://www.bensound.com/bensound-music/bensound-yellow.mp3" },
                { title: "–ò–Ω–¥–∏–≥–æ —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-indigo.mp3" },
                { title: "–ë–∏—Ä—é–∑–æ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-turquoise.mp3" },
                { title: "–ö–æ—Ä–∞–ª–ª–æ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-coral.mp3" },
                { title: "–õ–∞–≤–∞–Ω–¥–æ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-lavender.mp3" },
                { title: "–°–≤–µ–∂–∞—è –º—è—Ç–Ω–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-mint.mp3" },
                { title: "–ü–µ—Ä—Å–∏–∫–æ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-peach.mp3" },
                { title: "–†–æ–∑–æ–≤—ã–π —Å–∞–¥", url: "https://www.bensound.com/bensound-music/bensound-rose.mp3" },
                { title: "–õ–∏–ª–µ–π–Ω–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-lily.mp3" },
                { title: "–†–æ–º–∞—à–∫–æ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-daisy.mp3" },
                { title: "–¢—é–ª—å–ø–∞–Ω–æ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-tulip.mp3" },
                { title: "–ü–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∞—è —Ä–∞–¥–æ—Å—Ç—å", url: "https://www.bensound.com/bensound-music/bensound-sunflower.mp3" },
                { title: "–û—Ä—Ö–∏–¥–µ–π–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-orchid.mp3" },
                { title: "–ñ–∞—Å–º–∏–Ω–æ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-jasmine.mp3" },
                { title: "–õ–æ—Ç–æ—Å–æ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-lotus.mp3" },
                { title: "–ú–∞–≥–Ω–æ–ª–∏–µ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-magnolia.mp3" },
                { title: "–í–∏—à–Ω—ë–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-cherry.mp3" },
                { title: "–Ø–±–ª–æ—á–Ω–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-apple.mp3" },
                { title: "–ì—Ä—É—à–µ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-pear.mp3" },
                { title: "–°–ª–∏–≤–æ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-plum.mp3" },
                { title: "–í–∏–Ω–æ–≥—Ä–∞–¥–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-grape.mp3" },
                { title: "–ö–ª—É–±–Ω–∏—á–Ω–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-strawberry.mp3" },
                { title: "–ú–∞–ª–∏–Ω–æ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-raspberry.mp3" },
                { title: "–ß–µ—Ä–Ω–∏—á–Ω–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-blueberry.mp3" },
                { title: "–ö–ª—é–∫–≤–µ–Ω–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-cranberry.mp3" },
                { title: "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-orange.mp3" },
                { title: "–õ–∏–º–æ–Ω–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-lemon.mp3" },
                { title: "–õ–∞–π–º–æ–≤–∞—è –ª—é–±–æ–≤—å", url: "https://www.bensound.com/bensound-music/bensound-lime.mp3" },
                { title: "–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç–æ–≤–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞", url: "https://www.bensound.com/bensound-music/bensound-grapefruit.mp3" }
            ];
            
            let currentTrackIndex = 0;
            let isPlaying = false;
            let playedTracks = new Set(); // Track which tracks have been played
            
            // Get random track index
            function getRandomTrackIndex() {
                // If all tracks have been played, reset the set
                if (playedTracks.size >= musicTracks.length) {
                    playedTracks.clear();
                }
                
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * musicTracks.length);
                } while (playedTracks.has(randomIndex));
                
                playedTracks.add(randomIndex);
                return randomIndex;
            }

            // Load current track with error handling
            function loadTrack(index) {
                const track = musicTracks[index];
                backgroundMusic.src = track.url;
                trackTitle.textContent = track.title;
                
                // Add error handling for failed track loading
                backgroundMusic.addEventListener('error', function() {
                    console.log(`Failed to load track: ${track.title}`);
                    // Try next track if current fails
                    setTimeout(() => {
                        nextTrack();
                    }, 1000);
                }, { once: true });
            }
            
            // Play music with better error handling
            function playMusic() {
                backgroundMusic.volume = 0.15;
                
                // Try to play the current track
                const playPromise = backgroundMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                    isPlaying = true;
                    playPauseBtn.textContent = '‚è∏';
                        console.log(`Now playing: ${musicTracks[currentTrackIndex].title}`);
                }).catch(function(error) {
                    console.log('Play prevented:', error);
                        // Try to load and play next track
                        console.log('Trying next track...');
                        nextTrack();
                });
                }
            }
            
            // Pause music
            function pauseMusic() {
                backgroundMusic.pause();
                isPlaying = false;
                playPauseBtn.textContent = '‚ñ∂';
            }
            
            // Next track (random)
            function nextTrack() {
                currentTrackIndex = getRandomTrackIndex();
                loadTrack(currentTrackIndex);
                if (isPlaying) {
                    setTimeout(() => {
                    playMusic();
                    }, 500); // Small delay to ensure track is loaded
                }
            }
            
            // Previous track (random)
            function prevTrack() {
                currentTrackIndex = getRandomTrackIndex();
                loadTrack(currentTrackIndex);
                if (isPlaying) {
                    setTimeout(() => {
                    playMusic();
                    }, 500); // Small delay to ensure track is loaded
                }
            }
            
            // Event listeners
            playPauseBtn.addEventListener('click', function() {
                if (isPlaying) {
                    pauseMusic();
                } else {
                    playMusic();
                }
            });
            
            nextTrackBtn.addEventListener('click', nextTrack);
            prevTrackBtn.addEventListener('click', prevTrack);
            
            // Auto play next track when current ends
            backgroundMusic.addEventListener('ended', nextTrack);
            
            // Initialize with random track
            currentTrackIndex = getRandomTrackIndex();
            loadTrack(currentTrackIndex);
            
            // Try to play music when user first interacts with the page
            function playBackgroundMusic() {
                if (!isPlaying) {
                    console.log('Attempting to play background music...');
                    // Ensure we have a valid track loaded
                    if (!backgroundMusic.src) {
                        loadTrack(currentTrackIndex);
                    }
                    setTimeout(() => {
                    playMusic();
                    }, 200);
                }
            }
            
            // Play music on first user interaction
            document.addEventListener('click', playBackgroundMusic, { once: true });
            document.addEventListener('touchstart', playBackgroundMusic, { once: true });
            document.addEventListener('keydown', playBackgroundMusic, { once: true });
            
            // Also try to play music when welcome button is clicked
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('welcome-button')) {
                    console.log('Welcome button clicked, trying to play music...');
                    setTimeout(playBackgroundMusic, 100);
                }
            });
            
            // Try to play music when any button is clicked
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON' && !isPlaying) {
                    console.log('Button clicked, trying to play music...');
                    setTimeout(playBackgroundMusic, 50);
                }
            });
            
            // Add visual feedback for music player
            function updateMusicPlayerUI() {
                if (isPlaying) {
                    playPauseBtn.textContent = '‚è∏';
                    playPauseBtn.style.backgroundColor = '#ff69b4';
                } else {
                    playPauseBtn.textContent = '‚ñ∂';
                    playPauseBtn.style.backgroundColor = '#ff69b4';
                }
            }
            
            // AI Settings Panel functionality
            const aiSettingsBtn = document.getElementById('aiSettingsBtn');
            const aiSettingsPanel = document.getElementById('aiSettingsPanel');
            const closeAiSettings = document.getElementById('closeAiSettings');
            const saveApiKey = document.getElementById('saveApiKey');
            const testDeclension = document.getElementById('testDeclension');
            const openaiApiKey = document.getElementById('openaiApiKey');
            const declensionTest = document.getElementById('declensionTest');
            const testName = document.getElementById('testName');
            const testResults = document.getElementById('testResults');
            
            // Show AI settings panel
            aiSettingsBtn.addEventListener('click', function() {
                aiSettingsPanel.style.display = 'block';
                // Load saved API key if exists
                const savedKey = localStorage.getItem('openai_api_key');
                if (savedKey) {
                    openaiApiKey.value = savedKey;
                    setupAIDeclension(savedKey);
                }
            });
            
            // Close AI settings panel
            closeAiSettings.addEventListener('click', function() {
                aiSettingsPanel.style.display = 'none';
            });
            
            // Save API key
            saveApiKey.addEventListener('click', function() {
                const apiKey = openaiApiKey.value.trim();
                if (apiKey) {
                    localStorage.setItem('openai_api_key', apiKey);
                    setupAIDeclension(apiKey);
                    alert('API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –ò–ò-—Å–∫–ª–æ–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ.');
                } else {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á');
                }
            });
            
            // Test declension
            testDeclension.addEventListener('click', function() {
                declensionTest.style.display = 'block';
            });
            
            // Test name input
            testName.addEventListener('input', function() {
                const name = testName.value.trim();
                if (name) {
                    const results = `
                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è "${name}":</strong><br>
                        –†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π (–∫–æ–≥–æ?): ${declineName(name, 'genitive')}<br>
                        –î–∞—Ç–µ–ª—å–Ω—ã–π (–∫–æ–º—É?): ${declineName(name, 'dative')}<br>
                        –í–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π (–∫–æ–≥–æ?): ${declineName(name, 'accusative')}<br>
                        –¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π (–∫–µ–º?): ${declineName(name, 'instrumental')}<br>
                        –ü—Ä–µ–¥–ª–æ–∂–Ω—ã–π (–æ –∫–æ–º?): ${declineName(name, 'prepositional')}
                    `;
                    testResults.innerHTML = results;
                } else {
                    testResults.innerHTML = '';
                }
            });
        });

        let currentDistance = 20; // Total path length starts at 20
        const maxDistance = 20;
        const minDistance = 0;
        let uploadedPhotos = { photo1: null, photo2: null };
        let fighterNames = { name1: '', name2: '' };
        let faceDetector = null;
        let currentScreen = 'welcome';
        let currentQuestion = '';
        let currentQuestionIndex = 0; // To alternate between names
        let headerFadeTimeout = null;
        let questionMarkInterval = null;
        
        // Statistics tracking
        let playerStats = {
            player1: { correct: 0, total: 0, name: '' },
            player2: { correct: 0, total: 0, name: '' }
        };

        // AI-powered name declension system
        class NameDeclensionAI {
            constructor() {
                this.cache = new Map(); // Cache for declensions
                this.apiKey = null; // Will be set if available
            }
            
            // Set API key for OpenAI (optional)
            setApiKey(key) {
                this.apiKey = key;
            }
            
            // AI-powered declension using OpenAI API
            async declineNameWithAI(name, caseType = 'genitive') {
                if (!name) return name;
                
                // Check cache first
                const cacheKey = `${name}_${caseType}`;
                if (this.cache.has(cacheKey)) {
                    return this.cache.get(cacheKey);
                }
                
                // If no API key, fall back to rule-based system
                if (!this.apiKey) {
                    return this.declineNameRuleBased(name, caseType);
                }
                
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [{
                                role: 'system',
                                content: '–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä—É—Å—Å–∫–æ–π –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ. –°–∫–ª–æ–Ω—è–π –∏–º–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ –ø–∞–¥–µ–∂–∞–º.'
                            }, {
                                role: 'user',
                                content: `–°–∫–ª–æ–Ω–Ω–∏ –∏–º—è "${name}" –≤ ${this.getCaseDescription(caseType)}. –û—Ç–≤–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–∫–ª–æ–Ω–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º, –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.`
                            }],
                            max_tokens: 50,
                            temperature: 0.1
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const declinedName = data.choices[0].message.content.trim();
                        this.cache.set(cacheKey, declinedName);
                        return declinedName;
                    }
                } catch (error) {
                    console.log('AI declension failed, using rule-based:', error);
                }
                
                // Fallback to rule-based system
                return this.declineNameRuleBased(name, caseType);
            }
            
            // Rule-based declension (fallback)
            declineNameRuleBased(name, caseType = 'genitive') {
                if (!name || name.length < 2) return name;
                
                const nameLower = name.toLowerCase();
                const lastChar = nameLower.slice(-1);
                const secondLastChar = nameLower.slice(-2, -1);
                
                // Simple declension rules for common Russian names
                switch (caseType) {
                    case 'genitive': // –∫–æ–≥–æ? —á–µ–≥–æ?
                        if (lastChar === '–∞' || lastChar === '—è') {
                            return name.slice(0, -1) + (lastChar === '–∞' ? '—ã' : '–∏');
                        } else if (lastChar === '—å' || lastChar === '–π') {
                            return name.slice(0, -1) + '—è';
                        } else if (lastChar === '–æ' || lastChar === '–µ') {
                            return name.slice(0, -1) + '–∞';
                        } else {
                            return name + '–∞';
                        }
                    case 'dative': // –∫–æ–º—É? —á–µ–º—É?
                        if (lastChar === '–∞' || lastChar === '—è') {
                            return name.slice(0, -1) + (lastChar === '–∞' ? '–µ' : '–µ');
                        } else if (lastChar === '—å' || lastChar === '–π') {
                            return name.slice(0, -1) + '—é';
                        } else if (lastChar === '–æ' || lastChar === '–µ') {
                            return name.slice(0, -1) + '—É';
                        } else {
                            return name + '—É';
                        }
                    case 'accusative': // –∫–æ–≥–æ? —á—Ç–æ?
                        if (lastChar === '–∞' || lastChar === '—è') {
                            return name.slice(0, -1) + (lastChar === '–∞' ? '—É' : '—é');
                        } else if (lastChar === '—å' || lastChar === '–π') {
                            return name.slice(0, -1) + '—è';
                        } else if (lastChar === '–æ' || lastChar === '–µ') {
                            return name.slice(0, -1) + '–æ';
                        } else {
                            return name + '–∞';
                        }
                    case 'instrumental': // –∫–µ–º? —á–µ–º?
                        if (lastChar === '–∞' || lastChar === '—è') {
                            return name.slice(0, -1) + (lastChar === '–∞' ? '–æ–π' : '–µ–π');
                        } else if (lastChar === '—å' || lastChar === '–π') {
                            return name.slice(0, -1) + '–µ–º';
                        } else if (lastChar === '–æ' || lastChar === '–µ') {
                            return name.slice(0, -1) + '–æ–º';
                        } else {
                            return name + '–æ–º';
                        }
                    case 'prepositional': // –æ –∫–æ–º? –æ —á—ë–º?
                        if (lastChar === '–∞' || lastChar === '—è') {
                            return name.slice(0, -1) + (lastChar === '–∞' ? '–µ' : '–µ');
                        } else if (lastChar === '—å' || lastChar === '–π') {
                            return name.slice(0, -1) + '–µ';
                        } else if (lastChar === '–æ' || lastChar === '–µ') {
                            return name.slice(0, -1) + '–µ';
                        } else {
                            return name + '–µ';
                        }
                    default:
                        return name;
                }
            }
            
            // Get case description in Russian
            getCaseDescription(caseType) {
                const descriptions = {
                    'genitive': '—Ä–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ (–∫–æ–≥–æ? —á–µ–≥–æ?)',
                    'dative': '–¥–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ (–∫–æ–º—É? —á–µ–º—É?)',
                    'accusative': '–≤–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ (–∫–æ–≥–æ? —á—Ç–æ?)',
                    'instrumental': '—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ (–∫–µ–º? —á–µ–º?)',
                    'prepositional': '–ø—Ä–µ–¥–ª–æ–∂–Ω—ã–π –ø–∞–¥–µ–∂ (–æ –∫–æ–º? –æ —á—ë–º?)'
                };
                return descriptions[caseType] || '—Ä–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂';
            }
            
            // Synchronous declension (uses rule-based system)
            declineName(name, caseType = 'genitive') {
                return this.declineNameRuleBased(name, caseType);
            }
        }
        
        // Create global AI declension instance
        const nameDeclensionAI = new NameDeclensionAI();
        
        // Legacy function for backward compatibility
        function declineName(name, caseType = 'genitive') {
            return nameDeclensionAI.declineName(name, caseType);
        }

        // Function to replace "–ø–∞—Ä—Ç–Ω—ë—Ä" with properly declined name
        function personalizeQuestion(question, name) {
            if (!name) return question;
            
            // Replace different forms of "–ø–∞—Ä—Ç–Ω—ë—Ä" with properly declined name
            let personalizedQuestion = question;
            
            // Replace "–ø–∞—Ä—Ç–Ω—ë—Ä" (nominative) with name in nominative
            personalizedQuestion = personalizedQuestion.replace(/–ø–∞—Ä—Ç–Ω—ë—Ä/g, name);
            
            // Replace "–ø–∞—Ä—Ç–Ω—ë—Ä–∞" (genitive/accusative) with declined name
            personalizedQuestion = personalizedQuestion.replace(/–ø–∞—Ä—Ç–Ω—ë—Ä–∞/g, declineName(name, 'genitive'));
            
            // Replace "–ø–∞—Ä—Ç–Ω—ë—Ä—É" (dative) with declined name
            personalizedQuestion = personalizedQuestion.replace(/–ø–∞—Ä—Ç–Ω—ë—Ä—É/g, declineName(name, 'dative'));
            
            // Replace "–ø–∞—Ä—Ç–Ω—ë—Ä–æ–º" (instrumental) with declined name
            personalizedQuestion = personalizedQuestion.replace(/–ø–∞—Ä—Ç–Ω—ë—Ä–æ–º/g, declineName(name, 'instrumental'));
            
            // Replace "–ø–∞—Ä—Ç–Ω—ë—Ä–µ" (prepositional) with declined name
            personalizedQuestion = personalizedQuestion.replace(/–ø–∞—Ä—Ç–Ω—ë—Ä–µ/g, declineName(name, 'prepositional'));
            
            return personalizedQuestion;
        }
        
        // Function to set up AI declension (call this if you have OpenAI API key)
        function setupAIDeclension(apiKey) {
            if (apiKey) {
                nameDeclensionAI.setApiKey(apiKey);
                console.log('AI declension enabled with OpenAI API');
            } else {
                console.log('AI declension using rule-based system (no API key provided)');
            }
        }
        
        // Function to test declension
        function testDeclension(name) {
            console.log(`Testing declension for: ${name}`);
            console.log(`Genitive: ${declineName(name, 'genitive')}`);
            console.log(`Dative: ${declineName(name, 'dative')}`);
            console.log(`Accusative: ${declineName(name, 'accusative')}`);
            console.log(`Instrumental: ${declineName(name, 'instrumental')}`);
            console.log(`Prepositional: ${declineName(name, 'prepositional')}`);
        }
        
        // Array of deep personal questions
        const questions = [
            "–ö–æ–≥–æ –±—ã –ø—Ä–∏–≥–ª–∞—Å–∏–ª –ø–∞—Ä—Ç–Ω—ë—Ä –≤—ã–ø–∏—Ç—å –ø–∏–≤–∞, –µ—Å–ª–∏ –±—ã –º–æ–≥ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ª—é–±–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∏–∑ –ª—é–±–æ–π —ç–ø–æ—Ö–∏?",
            "–•–æ—Ç–µ–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –±—ã—Ç—å –æ—á–µ–Ω—å –∏–∑–≤–µ—Å—Ç–Ω—ã–º? –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –ú–∏—Å—Ç–µ—Ä –ë–∏—Å—Ç?",
            "–ö–∞–∫–∏–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å?",
            "–ö–∞–∫–∏–µ —Ç—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–∞—Ä—Ç–Ω—ë—Ä —Å—á–∏—Ç–∞–µ—Ç –æ–±—â–∏–º–∏ —É –≤–∞—Å –¥–≤–æ–∏—Ö?",
            "–ß—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä —Ö–æ—Ç–µ–ª –±—ã –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Å–≤–æ—ë–º –¥–µ—Ç—Å—Ç–≤–µ?",
            "–ö–∞–∫—É—é —Å—É–ø–µ—Ä—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ö–æ—Ç–µ–ª –±—ã –∏–º–µ—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
            "–°–æ–≥–ª–∞—Å–∏–ª—Å—è –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä —É–∑–Ω–∞—Ç—å –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —Å–≤–æ–µ–π —Å–º–µ—Ä—Ç–∏, –µ—Å–ª–∏ –±—ã –±—ã–ª–∞ —Ç–∞–∫–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å?",
            "–ö–∞–∫–æ–µ —Å–≤–æ—ë –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω—ë—Ä —Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–º –±–æ–ª—å—à–∏–º?",
            "–ö–∞–∫–æ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —Å–∞–º–æ–µ —Ü–µ–Ω–Ω–æ–µ?",
            "–ö–∞–∫–æ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —Å–∞–º–æ–µ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ–µ?",
            "–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –∂–∏–∑–Ω–∏, –µ—Å–ª–∏ –±—ã –∑–Ω–∞–ª, —á—Ç–æ —É–º—Ä—ë—Ç —á–µ—Ä–µ–∑ –≥–æ–¥?",
            "–°—á–∏—Ç–∞–µ—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä —Å–≤–æ—ë –¥–µ—Ç—Å—Ç–≤–æ –±–æ–ª–µ–µ —Å—á–∞—Å—Ç–ª–∏–≤—ã–º, —á–µ–º —É –¥—Ä—É–≥–∏—Ö?",
            "–ö–∞–∫–æ–π —Å–∞–º—ã–π —Å—Ç—ã–¥–Ω—ã–π —Å–ª—É—á–∞–π –±—ã–ª —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ö–æ–≥–¥–∞ –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø–ª–∞–∫–∞–ª –ø–µ—Ä–µ–¥ –∫–µ–º-—Ç–æ? –ê –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ?",
            "–û —á—ë–º –ø–∞—Ä—Ç–Ω—ë—Ä –ø–æ–∂–∞–ª–µ–ª –±—ã –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ, –µ—Å–ª–∏ –±—ã —É–º–µ—Ä —Å–µ–≥–æ–¥–Ω—è?",
            "–ß—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä –≤—ã–Ω–µ—Å –±—ã –∏–∑ –≥–æ—Ä—è—â–µ–≥–æ –¥–æ–º–∞ (–∫—Ä–æ–º–µ –±–ª–∏–∑–∫–∏—Ö –∏ –ø–∏—Ç–æ–º—Ü–µ–≤)?",
            "–ß—å—é —Å–º–µ—Ä—Ç—å –≤ —Å–µ–º—å–µ –ø–∞—Ä—Ç–Ω—ë—Ä –ø–µ—Ä–µ–∂–∏–ª –±—ã —Ç—è–∂–µ–ª–µ–µ –≤—Å–µ–≥–æ –∏ –ø–æ—á–µ–º—É?",
            "–ù–∞—Å–∫–æ–ª—å–∫–æ –ø–æ —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 10 –ø–∞—Ä—Ç–Ω—ë—Ä –≤–µ—Ä–∏—Ç –≤ –ë–æ–≥–∞?",
            "–ß—Ç–æ, –ø–æ –º–Ω–µ–Ω–∏—é –ø–∞—Ä—Ç–Ω—ë—Ä–∞, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏?",
            "–í–µ—Ä–∏—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –≤ —Ä–µ–∏–Ω–∫–∞—Ä–Ω–∞—Ü–∏—é?",
            "–í–µ—Ä–∏—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –≤ —Ä–∞–π –∏–ª–∏ –∞–¥?",
            "–î—É–º–∞–µ—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø—Ä–∏–∑—Ä–∞–∫–∏?",
            "–í–µ—Ä–∏—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω?",
            "–í–µ—Ä–∏—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –ù–õ–û?",
            "–í–µ—Ä–∏—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –ø–∞—Ä–∞–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ?",
            "–í–µ—Ä–∏—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—é?",
            "–ß—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –∫—Ä–∞—é –≤—Å–µ–ª–µ–Ω–Ω–æ–π ‚Äî –ø–æ –º–Ω–µ–Ω–∏—é –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ö–∞–∫, –ø–æ –º–Ω–µ–Ω–∏—é –ø–∞—Ä—Ç–Ω—ë—Ä–∞, –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –º–∏—Ä?",
            "–ù–∞ –∫–∞–∫—É—é –ø–ª–∞–Ω–µ—Ç—É –ø–µ—Ä–µ—Å–µ–ª–∏–ª—Å—è –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–î—É–º–∞–ª –ª–∏ –∫–æ–≥–¥–∞-—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä –æ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—É–∏—Ü–∏–¥–∞?",
            "–ö–∞–∫–æ–π –ª—é–±–∏–º—ã–π –±—Ä–µ–Ω–¥ –æ–¥–µ–∂–¥—ã —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ö–∞–∫–∏–µ 3 –±—Ä–µ–Ω–¥–∞ –æ–¥–µ–∂–¥—ã –ø–∞—Ä—Ç–Ω—ë—Ä –Ω–∏–∫–æ–≥–¥–∞ –±—ã –Ω–µ –Ω–∞–¥–µ–ª?",
            "–ö–∞–∫–æ–µ –ª—é–±–∏–º–æ–µ –±–ª—é–¥–æ –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ß—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä—É –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è: –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –Ω–∞ –ø–æ–µ–∑–¥–µ –∏–ª–∏ —Å–∞–º–æ–ª—ë—Ç–µ?",
            "–ö–∞–∫–∏–º –∂–∏–≤–æ—Ç–Ω—ã–º –±—ã–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä, –µ—Å–ª–∏ –±—ã –º–æ–≥ –≤—ã–±–∏—Ä–∞—Ç—å?",
            "–ö–µ–º –±—ã–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –∏–∑ –°–º–µ—à–∞—Ä–∏–∫–æ–≤?",
            "–ë–æ–∏—Ç—Å—è –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –∑–º–µ–π?",
            "–ë–æ–∏—Ç—Å—è –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –≤—ã—Å–æ—Ç—ã?",
            "–ë–æ–∏—Ç—Å—è –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –ø–∞—É–∫–æ–≤?",
            "–ö—Ç–æ –ª—é–±–∏–º—ã–π —Ä—ç–ø–µ—Ä –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ù–∞ —á–µ–π –∫–æ–Ω—Ü–µ—Ä—Ç –ø–∞—Ä—Ç–Ω—ë—Ä –º–µ—á—Ç–∞–µ—Ç —Å—Ö–æ–¥–∏—Ç—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
            "–ö–∞–∫—É—é –º–∞—à–∏–Ω—É –∫—É–ø–∏–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–°–∫–æ–ª—å–∫–æ –∫–Ω–∏–≥ –ø—Ä–æ—á–∏—Ç–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä –∑–∞ –ø—Ä–æ—à–µ–¥—à–∏–π –≥–æ–¥?",
            "–ö–∞–∫–æ–π –ª—é–±–∏–º—ã–π —Ñ–∏–ª—å–º –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ö–∞–∫–æ–π –ª—é–±–∏–º—ã–π –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–õ—é–±–∏–º—ã–π –∞–Ω–µ–∫–¥–æ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–õ—é–±–∏–º—ã–π –±–ª–æ–≥–µ—Ä –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ö–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ –ø–∞—Ä—Ç–Ω—ë—Ä —Å—á–∏—Ç–∞–µ—Ç –ª—é–±–∏–º—ã–º –∏ –ø–æ—á–µ–º—É?",
            "–ß–µ–≥–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –±–æ–∏—Ç—Å—è –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–ö–∞–∫–∞—è –ª—é–±–∏–º–∞—è –∏–≥—Ä—É—à–∫–∞ –±—ã–ª–∞ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≤ –¥–µ—Ç—Å—Ç–≤–µ?",
            "–ö—Ç–æ –±—ã–ª –ª—É—á—à–∏–º –¥—Ä—É–≥–æ–º –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≤ —à–∫–æ–ª–µ?",
            "–ö–∞–∫–∞—è –±—ã–ª–∞ –∫–ª–∏—á–∫–∞ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≤ —à–∫–æ–ª–µ?",
            "–ö–µ–º –ø–∞—Ä—Ç–Ω—ë—Ä —Ö–æ—Ç–µ–ª —Å—Ç–∞—Ç—å –≤ –¥–µ—Ç—Å—Ç–≤–µ?",
            "–í —á—ë–º, –ø–æ –º–Ω–µ–Ω–∏—é –ø–∞—Ä—Ç–Ω—ë—Ä–∞, —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ —Ç—Ä–∞–≤–º–∏—Ä–æ–≤–∞–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª–∏?",
            "–ö–∞–∫–æ–π –ø–µ—Ä–∏–æ–¥ –±—ã–ª –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —Å–∞–º—ã–º —Ç—è–∂—ë–ª—ã–º?",
            "–ö–∞–∫–æ–π –ª—É—á—à–∏–π —Å–æ–≤–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä –ø–æ–ª—É—á–∏–ª –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π?",
            "–ö–∞–∫–∏–µ –Ω–µ–∑–¥–æ—Ä–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–µ—Ä–µ–Ω—è–ª –ø–∞—Ä—Ç–Ω—ë—Ä –æ—Ç —Å–µ–º—å–∏?",
            "–ö–∞–∫ –≤–æ—Å–ø–∏—Ç—ã–≤–∞–ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞? –ö–∞–∫–∏–º–∏ –±—ã–ª–∏ –µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª–∏?",
            "–ï—Å—Ç—å –ª–∏ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –¥–µ—Ç—Å–∫–∏–µ –∏–ª–∏ –≤–∑—Ä–æ—Å–ª—ã–µ —Ç—Ä–∞–≤–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–≤–ª–∏—è–ª–∏ –Ω–∞ –Ω–µ–≥–æ?",
            "–ö–∞–∫–æ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤–∞—Å –¥–≤–æ–∏—Ö —Å–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–í—Ä–∞–ª –ª–∏ –∫–æ–≥–¥–∞-—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä –≤–∞–º?",
            "–ß—Ç–æ —Å–ª–æ–∂–Ω–µ–µ –≤—Å–µ–≥–æ —Å–∫–∞–∑–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä—É –≤–∞–º?",
            "–í –∫–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω—ë—Ä —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è —É—è–∑–≤–∏–º—ã–º —Ä—è–¥–æ–º —Å –≤–∞–º–∏?",
            "–ß—Ç–æ –µ–≥–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—É–≥–∞–µ—Ç –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?",
            "–ü—Ä–µ–¥–∞–≤–∞–ª –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –∫–æ–≥–¥–∞-—Ç–æ –±–ª–∏–∑–∫–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?",
            "–ò—Å–ø—ã—Ç—ã–≤–∞–ª –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –æ—Ç —Ç–µ—Ö, –∫–æ–º—É –¥–æ–≤–µ—Ä—è–ª?",
            "–ö–∞–∫–æ–π —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —è–∑—ã–∫ –ª—é–±–≤–∏?",
            "–ö–∞–∫–æ–π —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —Ç–∏–ø –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏?",
            "–ß—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä —É–∑–Ω–∞–ª –∏–∑ —Å–≤–æ–∏—Ö –ø—Ä–æ—à–ª—ã—Ö —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π?",
            "–ö–∞–∫ –ø–∞—Ä—Ç–Ω—ë—Ä –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –±—Ä–∞–∫—É?",
            "–°—á–∏—Ç–∞–µ—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä, —á—Ç–æ –≤–∞–∂–Ω–æ –ø—Ä–æ—â–∞—Ç—å?",
            "–ö–∞–∫ –ø–∞—Ä—Ç–Ω—ë—Ä —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏?",
            "–ì–æ—Ç–æ–≤ –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –∏–¥—Ç–∏ –Ω–∞ –ø–∞—Ä–Ω—É—é —Ç–µ—Ä–∞–ø–∏—é, –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã?",
            "–ß—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ü–µ–Ω–∏—Ç –≤ –¥—Ä—É–∂–±–µ?",
            "–ß—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ª—é–±—è—Ç –¥—Ä—É–∑—å—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≤ –Ω—ë–º?",
            "–ö–∞–∫–∞—è —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≥–ª–∞–≤–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Ü–µ–ª—å?",
            "–ö–∞–∫–∏–º –ø–∞—Ä—Ç–Ω—ë—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–æ–º?",
            "–ì–¥–µ –ø–∞—Ä—Ç–Ω—ë—Ä —Ö–æ—Ç–µ–ª –±—ã –∂–∏—Ç—å?",
            "–ö–∞–∫–∏–º –ø–∞—Ä—Ç–Ω—ë—Ä –≤–∏–¥–∏—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –æ—Ç–ø—É—Å–∫?",
            "–°–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π —Ö–æ—Ç–µ–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–ì–¥–µ –ø–∞—Ä—Ç–Ω—ë—Ä –≤–∏–¥–∏—Ç —Å–µ–±—è —á–µ—Ä–µ–∑ 5-10 –ª–µ—Ç?",
            "–•–æ—á–µ—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –¥–µ—Ç–µ–π –∏–ª–∏ –¥–æ–º–∞—à–Ω–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö? –ï—Å–ª–∏ –¥–∞, —Ç–æ —Å–∫–æ–ª—å–∫–æ?",
            "–ö–∞–∫–∏–µ –∏–º–µ–Ω–∞ –¥–ª—è –¥–µ—Ç–µ–π –≤—ã–±—Ä–∞–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–ö–∞–∫–∞—è —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –Ω–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–µ–∫—Å—É–∞–ª—å–Ω–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è?",
            "–ö–∞–∫ —á–∞—Å—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä —Ö–æ—á–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–µ–∫—Å–æ–º?",
            "–ö–∞–∫–∏–µ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –ø—Ä–∏–≤—ã—á–∫–∏ —Å–Ω–∞?",
            "–ß—Ç–æ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –æ–∑–Ω–∞—á–∞–µ—Ç ¬´—á–∏—Å—Ç—ã–π –¥–æ–º¬ª?",
            "–ö–∞–∫ –ø–∞—Ä—Ç–Ω—ë—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –∏ –¥–æ–ª–≥–∞–º–∏?",
            "–ï—Å—Ç—å –ª–∏ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –¥–æ–ª–≥–∏?",
            "–ú–æ–∂–µ—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –∏–º–µ—Ç—å –¥—Ä—É–∑–µ–π –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–≥–æ –ø–æ–ª–∞?",
            "–ù–∞—Å–∫–æ–ª—å–∫–æ –ø–æ —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 10 –ø–∞—Ä—Ç–Ω—ë—Ä —Å—á–∏—Ç–∞–µ—Ç —Å–µ–±—è –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º?",
            "–ß–µ–º –ø–∞—Ä—Ç–Ω—ë—Ä –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≥–æ—Ä–¥–∏—Ç—Å—è –≤ —Å–µ–±–µ?",
            "–ö–∞–∫–æ–π —Å–∞–º—ã–π —Å—Ç—Ä–∞–Ω–Ω—ã–π —Ç–∞–ª–∞–Ω—Ç –µ—Å—Ç—å —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –Ω–∞–≤—Å–µ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏—Ç—å –≥–æ–ª–æ—Å–æ–º —Ç–∏–∫—Ç–æ–∫–µ—Ä—à–∏ –∏–∑ –æ–∑–≤—É—á–µ–∫ –∏–ª–∏ —Å–º–µ—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∑–ª–æ–±–Ω—ã–π –º—É–ª—å—Ç—è—à–Ω—ã–π —Å–∫–µ–ª–µ—Ç?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: —Ä—É–∫–∏-—Å–µ–ª—Ñ–∏-–ø–∞–ª–∫–∏ –∏–ª–∏ –Ω–æ–≥–∏-–≥–∏—Ä–æ—Å–∫—É—Ç–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–∞–º–∏ –µ–¥—É—Ç, –∫—É–¥–∞ —Ö–æ—Ç—è—Ç?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –≤–º–µ—Å—Ç–æ –≤–æ–ª–æ—Å –∏–º–µ—Ç—å –ª–∞–ø—à—É –î–æ—à–∏—Ä–∞–∫ –∏–ª–∏ –≤–º–µ—Å—Ç–æ –±–æ—Ä–æ–¥—ã –∫—É—Å–æ—á–∫–∏ —Å–∫–æ—Ç—á–∞, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å—ë –≤—Ä–µ–º—è –ª–∏–ø–Ω—É—Ç?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ—Ü–µ–ª—É–µ –∑–≤—É—á–∞–ª–∞ –±—ã –ø–µ—Å–Ω—è ¬´–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä–∞–ª¬ª –∏–ª–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ —Å—Å–æ—Ä–µ –≤–∫–ª—é—á–∞–ª—Å—è –±—ã –¥–µ—Ç—Å–∫–∏–π —Å–º–µ—Ö –∏–∑ —Ö–æ—Ä—Ä–æ—Ä–∞?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –ø–∞–ª—å—Ü—ã –≤ –≤–∏–¥–µ USB-—Ñ–ª–µ—à–µ–∫ –∏–ª–∏ –Ω–æ—Å-–ø–∏–ø–µ—Ç–∫—É, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –≤—Å–µ–≥–¥–∞ –∫–∞–ø–∞–µ—Ç –≤–æ–¥–∞?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –≤—Å–µ–≥–¥–∞ —Ö–æ–¥–∏—Ç—å –≤ Crocs —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –≥–∏—Ä–ª—è–Ω–¥–∞–º–∏ –∏–ª–∏ –≤—Å—é –∂–∏–∑–Ω—å –Ω–æ—Å–∏—Ç—å —à–∞–ø–∫—É –≤ —Ñ–æ—Ä–º–µ –∞—Ä–±—É–∑–∞?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: —è–∑—ã–∫-–≥—É–±–∫—É –¥–ª—è –º—ã—Ç—å—è –ø–æ—Å—É–¥—ã –∏–ª–∏ –∑—É–±—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ–≥–¥–∞ –≤—ã—Å—Ç—Ä–æ–µ–Ω—ã –≤ —Å–ª–æ–≤–æ ¬´LOL¬ª?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –≥–æ–ª–æ—Å Siri, –Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ 5 —Å–µ–∫—É–Ω–¥, –∏–ª–∏ —Å–º–µ—Ö –∫–∞–∫ —É –ü–∞—Ç—Ä–∏–∫–∞ –∏–∑ ¬´–°–ø–∞–Ω—á –ë–æ–±–∞¬ª?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –≤–º–µ—Å—Ç–æ –±—Ä–æ–≤–µ–π –∏–º–µ—Ç—å –¥–≤–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –≥—É—Å–µ–Ω–∏—Ü—ã –∏–ª–∏ –≤–º–µ—Å—Ç–æ —É—à–µ–π –º–∏–Ω–∏-–∫–∞—Å—Ç—Ä—é–ª–∏?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –æ–Ω –∑–ª–∏—Ç—Å—è, –Ω–∞ –ª–±—É –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞–¥–ø–∏—Å—å ¬´–û—à–∏–±–∫–∞ 404¬ª –∏–ª–∏ –ø—Ä–∏ —Ä–∞–¥–æ—Å—Ç–∏ –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è –Ω–∞–¥–ø–∏—Å—å ¬´Loading‚Ä¶¬ª?",
            "–ß—Ç–æ –±—ã –≤—ã–±—Ä–∞–ª –ø–∞—Ä—Ç–Ω—ë—Ä: –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ü–µ–ª–æ–≤–∞—Ç—å—Å—è –∏–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±–Ω–∏–º–∞—Ç—å—Å—è?",
            "–° –∫–∞–∫–æ–π —Å–≤–æ–µ–π –≤–µ—Ä—Å–∏–µ–π –∏–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π —Ö–æ—Ç–µ–ª –±—ã –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–ü–æ–ª—é–±–∏–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –≤–∞—Å, –µ—Å–ª–∏ –±—ã –≤—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∏—Å—å –≤ –º–µ–¥–≤–µ–¥—è?",
            "–ß—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä —Å–¥–µ–ª–∞–ª –±—ã –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –≤ –∑–æ–º–±–∏-–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–µ?",
            "–ö–∞–∫–æ–µ –æ—Ä—É–∂–∏–µ –≤—ã–±—Ä–∞–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –≤ –∑–æ–º–±–∏-–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–µ?",
            "–ß—Ç–æ —Å–¥–µ–ª–∞–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä, –µ—Å–ª–∏ –±—ã —É–∑–Ω–∞–ª, —á—Ç–æ –æ–Ω —Å—ã–Ω –ü–∞–≤–ª–∞ –î—É—Ä–æ–≤–∞?",
            "–í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –∏ –º–µ—Å—Ç–æ –≤ –ø—Ä–æ—à–ª–æ–º –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –∏ –∫–∞–∫–æ–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –ø—Ä–∏–≤—ë–∑ –±—ã —Å —Å–æ–±–æ–π?",
            "–ö–∞–∫ –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –æ—Ç—Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª –Ω–∞ –≤—Å—Ç—Ä–µ—á—É —Å –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω–æ–º?",
            "–í—Å—Ç—Ä–µ—Ç–∏–≤—à–∏—Å—å —Å –ü—É—Ç–∏–Ω—ã–º, —á—Ç–æ —Å–∫–∞–∑–∞–ª –±—ã –µ–º—É –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–ö–∞–∫–∏–º –∂–∏–≤–æ—Ç–Ω—ã–º —Å—Ç–∞–ª –±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –Ω–∞ –æ–¥–∏–Ω –¥–µ–Ω—å?",
            "–ï—Å—Ç—å –ª–∏ —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –∑–Ω–∞–∫–æ–º—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —É–±–∏–≤–∞–ª–∏ –ª—é–¥–µ–π?",
            "–£–±–∏–≤–∞–ª –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –∂–∏–≤–æ—Ç–Ω–æ–µ?",
            "–õ—é–±–∏—Ç –ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä —Ä—ã–±–∞–ª–∫—É?",
            "–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–µ—à–∞—Ç—å —Ç—É–∞–ª–µ—Ç–Ω—É—é –±—É–º–∞–≥—É ‚Äî —Å–≤–µ—Ä—Ö—É –∏–ª–∏ —Å–Ω–∏–∑—É, –ø–æ –º–Ω–µ–Ω–∏—é –ø–∞—Ä—Ç–Ω—ë—Ä–∞?",
            "–ö–∞–∫–∏–µ —Å–µ–º–µ–π–Ω—ã–µ —Ç–∞–π–Ω—ã –∑–Ω–∞–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä?",
            "–ö–∞–∫–∞—è —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è –±–æ—è–∑–Ω—å?",
            "–û —á—ë–º –ø–∞—Ä—Ç–Ω—ë—Ä –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∂–∞–ª–µ–µ—Ç?",
            "–ö–∞–∫–æ–µ —Å–∞–º–æ–µ —Ö—É–¥—à–µ–µ, —á—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä –∫–æ–≥–¥–∞-–ª–∏–±–æ –¥–µ–ª–∞–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –¥—Ä—É–≥–æ–º—É —á–µ–ª–æ–≤–µ–∫—É? –ö–∞–∫ –æ–Ω –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —ç—Ç–æ–º—É —Å–µ–≥–æ–¥–Ω—è?"
        ];
        
        function moveDots(action) {
            const dot1 = document.querySelector('.dot1');
            const dot2 = document.querySelector('.dot2');
            const root = document.querySelector('.root');
            
            // Determine which player answered (alternating)
            const currentPlayer = currentQuestionIndex % 2 === 0 ? 'player1' : 'player2';
            playerStats[currentPlayer].total++;
            
            if (action === 'correct') {
                // Move dots 1 unit closer
                currentDistance = Math.max(minDistance, currentDistance - 1);
                // Show heart animation
                showAnswerAnimation('heart');
                // Update stats
                playerStats[currentPlayer].correct++;
            } else if (action === 'incorrect') {
                // Move dots 0.5 units apart
                currentDistance = Math.min(maxDistance, currentDistance + 0.5);
                // Show broken heart animation
                showAnswerAnimation('broken-heart');
            }
            
            updateDotPositions();
            updateScoreDisplay();
            
            // Change question after each answer
            showRandomQuestion();
            
            // Check for victory condition
            if (currentDistance <= 0) {
                showVictoryScreen();
            }
        }
        
        function updateDotPositions() {
            const dot1 = document.querySelector('.dot1');
            const dot2 = document.querySelector('.dot2');
            const root = document.querySelector('.root');
            const container = document.querySelector('.dots-container');
            
            // Calculate positions based on current distance
            // Use actual container width for responsive design
            const containerWidth = container.offsetWidth;
            const dotSize = 20;
            const availableWidth = containerWidth - dotSize;
            
            // Convert distance to percentage
            const distancePercentage = (currentDistance / maxDistance) * 100;
            const leftPosition = (100 - distancePercentage) / 2;
            const rightPosition = leftPosition;
            
            // Update dot positions
            dot1.style.left = `${leftPosition}%`;
            dot2.style.right = `${rightPosition}%`;
            
            // Update root line
            root.style.left = `${leftPosition + 1}%`;
            root.style.right = `${rightPosition + 1}%`;
            
            // Remove any existing classes
            root.classList.remove('initial', 'correct', 'incorrect');
            
            if (currentDistance <= 0) {
                root.classList.add('correct');
            } else {
                root.classList.add('initial');
            }
        }
        
        function updateScoreDisplay() {
            let scoreElement = document.querySelector('.score-display');
            if (!scoreElement) {
                scoreElement = document.createElement('div');
                scoreElement.className = 'score-display';
                scoreElement.style.cssText = `
                    position: absolute;
                    top: 20px;
                    left: 20px;
                    color: #ff69b4;
                    font-size: 18px;
                    font-weight: bold;
                `;
                document.querySelector('.container').appendChild(scoreElement);
            }
            
            const progress = ((maxDistance - currentDistance) / maxDistance * 100).toFixed(1);
            scoreElement.textContent = `Progress: ${progress}%`;
        }

        function showVictoryScreen() {
            // Hide game screen and show victory screen
            showScreen('victory');
            createVictoryTexts();
            startHeartAnimation();
        }
        
        function createVictoryTexts() {
            const victoryScreen = document.getElementById('victoryScreen');
            
            // Create 40 "love" texts and make them fall immediately
            for (let i = 0; i < 40; i++) {
                const loveText = document.createElement('div');
                loveText.className = 'victory-text love';
                loveText.textContent = 'love';
                
                // Random position all over the screen
                loveText.style.left = Math.random() * 100 + '%';
                loveText.style.top = Math.random() * 100 + '%';
                loveText.style.fontSize = (Math.random() * 200 + 300) + 'px';
                
                // Start falling immediately with pulsation - smoother timing
                const duration = Math.random() * 3 + 8; // 8-11 seconds for smoother movement
                loveText.style.animation = `fallDown ${duration}s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite, fontPulse ${Math.random() * 2 + 2}s ease-in-out infinite`;
                loveText.style.animationDelay = '0s';
                
                victoryScreen.appendChild(loveText);
                
                // Remove text after it falls off screen
                setTimeout(() => {
                    if (loveText.parentNode) {
                        loveText.parentNode.removeChild(loveText);
                    }
                }, (duration + 2) * 1000);
            }
            
            // Start continuous text creation immediately
            startContinuousTextCreation();
        }
        
        
        function startContinuousTextCreation() {
            const victoryScreen = document.getElementById('victoryScreen');
            
            function createNewText() {
                const loveText = document.createElement('div');
                loveText.className = 'victory-text love';
                loveText.textContent = 'love';
                
                // Random horizontal position, start from top
                loveText.style.left = Math.random() * 100 + '%';
                loveText.style.top = '-200px'; // Start above the screen
                loveText.style.fontSize = (Math.random() * 200 + 300) + 'px';
                
                // Fall down animation with variable speed - NO DELAY - smoother
                const duration = Math.random() * 3 + 8; // 8-11 seconds for smoother movement
                loveText.style.animation = `fallDown ${duration}s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite, fontPulse ${Math.random() * 2 + 2}s ease-in-out infinite`;
                loveText.style.animationDelay = '0s'; // Force no delay
                
                victoryScreen.appendChild(loveText);
                
                // Remove text after it falls off screen
                setTimeout(() => {
                    if (loveText.parentNode) {
                        loveText.parentNode.removeChild(loveText);
                    }
                }, (duration + 2) * 1000);
            }
            
            // Create new text every 0.4 seconds for smoother continuous falling
            const textInterval = setInterval(createNewText, 400);
            
            // Store interval ID for cleanup
            window.textInterval = textInterval;
        }
        
        function startHeartAnimation() {
            const heartSymbols = ['‚ô•', 'üíñ', 'üíï', 'üíó', 'üíù', 'üíò', 'üíû', 'üíì', 'üíî', 'üíü'];
            
            function createHeart() {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
                heart.style.fontSize = (Math.random() * 15 + 20) + 'px';
                heart.style.opacity = Math.random() * 0.5 + 0.7;
                
                document.body.appendChild(heart);
                
                // Remove heart after animation
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 5000);
            }
            
            // Create hearts continuously - smoother timing
            const heartInterval = setInterval(createHeart, 200);
            
            // Store interval ID for cleanup
            window.heartInterval = heartInterval;
        }
        
        function restartGame() {
            // Stop heart animation
            if (window.heartInterval) {
                clearInterval(window.heartInterval);
            }
            
            // Stop text creation
            if (window.textInterval) {
                clearInterval(window.textInterval);
            }
            
            // Remove all existing hearts
            const hearts = document.querySelectorAll('.heart');
            hearts.forEach(heart => heart.remove());
            
            // Remove all victory texts
            const victoryTexts = document.querySelectorAll('.victory-text');
            victoryTexts.forEach(text => text.remove());
            
            // Reset game state
            currentDistance = 20;
            
            // Go back to game screen
            showScreen('game');
            updateDotPositions();
            updateScoreDisplay();
            showRandomQuestion();
        }

        // Initialize face detection
        async function initializeFaceDetection() {
            try {
                faceDetector = new FaceDetection({
                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection@0.4/${file}`
                });
                await faceDetector.setOptions({
                    model: 'short',
                    minDetectionConfidence: 0.5,
                });
                console.log('Face detection initialized');
            } catch (error) {
                console.error('Error initializing face detection:', error);
                // Fallback to simple center crop if face detection fails
            }
        }

        // Photo upload and processing functions
        function handlePhotoUpload(dotNumber, input) {
            const file = input.files[0];
            if (file) {
                uploadedPhotos[`photo${dotNumber}`] = file;
                autoCropPhoto(file, dotNumber);
            }
        }

        async function autoCropPhoto(file, dotNumber) {
            showProcessingModal(`–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ ${dotNumber}...`);
            
            try {
                const img = new Image();
                const reader = new FileReader();
                
                reader.onload = async function(e) {
                    img.onload = async function() {
                        try {
                            let cropData;
                            
                            if (faceDetector) {
                                // Try face detection first
                                cropData = await detectAndCropFace(img);
                            }
                            
                            if (!cropData) {
                                // Fallback to center crop
                                cropData = getCenterCrop(img);
                            }
                            
                            const croppedFile = await cropImageToFile(img, cropData);
                            uploadedPhotos[`photo${dotNumber}`] = croppedFile;
                            
                            hideProcessingModal();
                            checkPhotosReady();
                            
                        } catch (error) {
                            console.error('Error processing photo:', error);
                            // Fallback to center crop
                            const cropData = getCenterCrop(img);
                            const croppedFile = await cropImageToFile(img, cropData);
                            uploadedPhotos[`photo${dotNumber}`] = croppedFile;
                            
                            hideProcessingModal();
                            checkPhotosReady();
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error('Error reading file:', error);
                hideProcessingModal();
            }
        }

        async function detectAndCropFace(img) {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                const detections = await faceDetector.detect(canvas);
                
                if (detections && detections.length > 0) {
                    // Get the largest face
                    const largestFace = detections.reduce((largest, current) => {
                        const currentArea = current.boundingBox.width * current.boundingBox.height;
                        const largestArea = largest.boundingBox.width * largest.boundingBox.height;
                        return currentArea > largestArea ? current : largest;
                    });
                    
                    const bbox = largestFace.boundingBox;
                    
                    // Calculate face center
                    const faceCenterX = bbox.x + bbox.width / 2;
                    const faceCenterY = bbox.y + bbox.height / 2;
                    
                    // Create square crop centered on face
                    const cropSize = Math.max(bbox.width, bbox.height) * 1.8; // 80% larger than face
                    const halfSize = cropSize / 2;
                    
                    // Center the crop on the face
                    const x = Math.max(0, Math.min(img.width - cropSize, faceCenterX - halfSize));
                    const y = Math.max(0, Math.min(img.height - cropSize, faceCenterY - halfSize));
                    const width = Math.min(cropSize, img.width - x);
                    const height = Math.min(cropSize, img.height - y);
                    
                    return { x, y, width, height };
                }
            } catch (error) {
                console.error('Face detection error:', error);
            }
            return null;
        }

        function getCenterCrop(img) {
            // Fallback: crop center square of the image
            const cropSize = Math.min(img.width, img.height) * 0.8; // 80% of smaller dimension
            const x = (img.width - cropSize) / 2;
            const y = (img.height - cropSize) / 2;
            
            return { x, y, width: cropSize, height: cropSize };
        }

        async function cropImageToFile(img, cropData) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Standard size for all faces (square)
            const standardSize = 200; // 200x200 pixels for all faces
            canvas.width = standardSize;
            canvas.height = standardSize;
            
            // Draw cropped portion scaled to standard size
            ctx.drawImage(
                img,
                cropData.x, cropData.y, cropData.width, cropData.height,
                0, 0, standardSize, standardSize
            );
            
            // Convert to blob
            return new Promise((resolve) => {
                canvas.toBlob(function(blob) {
                    const croppedFile = new File([blob], `cropped_photo.jpg`, { type: 'image/jpeg' });
                    resolve(croppedFile);
                }, 'image/jpeg', 0.9);
            });
        }


        function showProcessingModal(text) {
            const modal = document.getElementById('processingModal');
            const textElement = document.getElementById('processingText');
            textElement.textContent = text;
            modal.style.display = 'flex';
        }

        function hideProcessingModal() {
            const modal = document.getElementById('processingModal');
            modal.style.display = 'none';
        }

        function checkPhotosReady() {
            const processBtn = document.getElementById('processBtn');
            if (uploadedPhotos.photo1 && uploadedPhotos.photo2) {
                processBtn.disabled = false;
                processBtn.textContent = 'Process Photos';
            } else {
                processBtn.disabled = true;
                processBtn.textContent = 'Upload Both Photos';
            }
        }

        function processPhotos() {
            const processBtn = document.getElementById('processBtn');
            processBtn.disabled = true;
            processBtn.textContent = 'Processing...';

            // Simulate photo processing (in a real app, you'd use AI/ML services)
            setTimeout(() => {
                displayProcessedPhotos();
                processBtn.textContent = 'Photos Processed!';
                processBtn.style.backgroundColor = '#4CAF50';
            }, 2000);
        }

        function displayProcessedPhotos() {
            // Create image elements for the processed photos
            const person1Img = document.getElementById('person1');
            const person2Img = document.getElementById('person2');

            // For demo purposes, we'll use the uploaded photos directly
            // In a real implementation, you'd use AI to extract people from photos
            if (uploadedPhotos.photo1) {
                const reader1 = new FileReader();
                reader1.onload = function(e) {
                    person1Img.src = e.target.result;
                    person1Img.style.display = 'block';
                };
                reader1.readAsDataURL(uploadedPhotos.photo1);
            } else {
                // Hide photo if not uploaded
                person1Img.style.display = 'none';
            }

            if (uploadedPhotos.photo2) {
                const reader2 = new FileReader();
                reader2.onload = function(e) {
                    person2Img.src = e.target.result;
                    person2Img.style.display = 'block';
                };
                reader2.readAsDataURL(uploadedPhotos.photo2);
            } else {
                // Hide photo if not uploaded
                person2Img.style.display = 'none';
            }
        }

        // Screen management functions
        function showScreen(screenName) {
            // Hide all screens
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('kissingScreen').style.display = 'none';
            document.getElementById('fighterScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('endScreen').style.display = 'none';
            document.getElementById('victoryScreen').style.display = 'none';
            document.getElementById('statsScreen').style.display = 'none';
            
            // Show the requested screen
            switch(screenName) {
                case 'welcome':
                    document.getElementById('welcomeScreen').style.display = 'flex';
                    break;
                case 'kissing':
                    document.getElementById('kissingScreen').style.display = 'flex';
                    break;
                case 'fighter':
                    document.getElementById('fighterScreen').style.display = 'flex';
                    break;
                case 'game':
                    document.getElementById('gameScreen').style.display = 'flex';
                    break;
                case 'end':
                    document.getElementById('endScreen').style.display = 'flex';
                    break;
                case 'victory':
                    document.getElementById('victoryScreen').style.display = 'flex';
                    break;
                case 'stats':
                    document.getElementById('statsScreen').style.display = 'flex';
                    break;
            }
            currentScreen = screenName;
        }

        // Game flow functions
        function showKissingScreenWithHearts() {
            // Show heart animations
            showHeartAnimation();
            // Then show kissing screen
            setTimeout(() => {
                showScreen('kissing');
            }, 1500);
        }

        function showKissingScreen() {
            showScreen('kissing');
        }

        function showQuestionAndButton() {
            // Change text to "—Ç–æ—á–Ω–æ?" and button to "–¥–∞" simultaneously
            const kissingText = document.getElementById('kissingText');
            const kissButton = document.getElementById('kissButton');
            
            kissingText.textContent = '—Ç–æ—á–Ω–æ?';
            kissButton.textContent = '–¥–∞';
            kissButton.onclick = showQuestionMarksAndKisses;
            
            // Show falling question marks from bottom
            showQuestionMarkAnimation();
        }

        function showQuestionMarksAndKisses() {
            // Stop the continuous question mark animation
            if (questionMarkInterval) {
                clearInterval(questionMarkInterval);
                questionMarkInterval = null;
            }
            
            // Remove all existing question mark elements
            const questionMarkElements = document.querySelectorAll('.question-mark-animation');
            questionMarkElements.forEach(element => {
                if (element.parentNode) {
                    element.parentNode.removeChild(element);
                }
            });
            
            // Show kiss animations immediately
            showKissAnimation();
            
            // Keep text and button visible for 1.5 seconds, then transition
            setTimeout(() => {
                showScreen('fighter');
            }, 1500);
        }

        function startGameWithKisses() {
            // Show kiss animations
            showKissAnimation();
            // Then start game
            setTimeout(() => {
                showScreen('fighter');
            }, 1500);
        }

        function startGame() {
            showScreen('fighter');
        }

        function handleFighterUpload(fighterNumber, input) {
            const file = input.files[0];
            if (file) {
                uploadedPhotos[`photo${fighterNumber}`] = file;
                autoCropPhoto(file, fighterNumber);
            } else {
                // Clear the photo if no file selected
                uploadedPhotos[`photo${fighterNumber}`] = null;
                // Hide the photo display
                const photoElement = document.getElementById(`person${fighterNumber}`);
                if (photoElement) {
                    photoElement.style.display = 'none';
                }
            }
            checkFightersReady();
        }

        function updateFighterName(fighterNumber, input) {
            fighterNames[`name${fighterNumber}`] = input.value.trim();
            checkFightersReady();
        }


        function checkFightersReady() {
            const startBtn = document.getElementById('startGameBtn');
            if (fighterNames.name1 && fighterNames.name2) {
                startBtn.disabled = false;
                startBtn.textContent = '–ù–∞—á–∞—Ç—å –ø—É—Ç—å –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π –ª—é–±–≤–∏!';
            } else {
                startBtn.disabled = true;
                startBtn.textContent = '–í–≤–µ–¥–∏—Ç–µ –∏–º–µ–Ω–∞ –æ–±–æ–∏—Ö –±–æ–π—Ü–æ–≤';
            }
        }

        function beginGame() {
            // Initialize player stats with names
            playerStats.player1.name = fighterNames.name1;
            playerStats.player2.name = fighterNames.name2;
            playerStats.player1.correct = 0;
            playerStats.player1.total = 0;
            playerStats.player2.correct = 0;
            playerStats.player2.total = 0;
            
            // Show mixed heart animation
            showMixedHeartAnimation();
            // Then start game
            setTimeout(() => {
                showScreen('game');
                displayProcessedPhotos();
                updateDotPositions();
                updateScoreDisplay();
                showRandomQuestion();
            }, 1500);
        }

        function showRandomQuestion() {
            const questionDisplay = document.getElementById('questionDisplay');
            const questionHeader = document.getElementById('questionHeader');
            let newQuestion;
            
            // Make sure we don't show the same question twice in a row
            do {
                newQuestion = questions[Math.floor(Math.random() * questions.length)];
            } while (newQuestion === currentQuestion && questions.length > 1);
            
            // Alternate between the two names
            const currentName = currentQuestionIndex % 2 === 0 ? fighterNames.name1 : fighterNames.name2;
            currentQuestionIndex++;
            
            // Replace "–ø–∞—Ä—Ç–Ω—ë—Ä" with the actual name using proper declension
            const personalizedQuestion = personalizeQuestion(newQuestion, currentName);
            
            // Clear any existing fade timeout to ensure consistent timing
            if (headerFadeTimeout) {
                clearTimeout(headerFadeTimeout);
            }
            
            // Reset and update question header
            questionHeader.className = 'question-header'; // Remove fade-out class
            questionHeader.style.opacity = '1'; // Reset opacity
            questionHeader.style.animation = 'none'; // Reset animation
            questionHeader.textContent = `–í–æ–ø—Ä–æ—Å –¥–ª—è ${currentName}`;
            
            // Force reflow to ensure reset is applied
            questionHeader.offsetHeight;
            
            // Start fade-out animation after exactly 4 seconds
            headerFadeTimeout = setTimeout(() => {
                questionHeader.classList.add('fade-out');
                // Ensure the animation starts
                questionHeader.style.animation = 'fadeOut 1s ease-out forwards';
            }, 4000);
            
            currentQuestion = newQuestion;
            questionDisplay.textContent = personalizedQuestion;
        }

        function showAnswerAnimation(type) {
            const gameScreen = document.getElementById('gameScreen');
            const animation = document.createElement('div');
            
            if (type === 'heart') {
                animation.className = 'answer-heart';
                animation.textContent = '‚ô•';
            } else if (type === 'broken-heart') {
                animation.className = 'answer-broken-heart';
                animation.textContent = 'üíî';
            }
            
            // Position animation randomly around the center
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const randomX = centerX + (Math.random() - 0.5) * 200;
            const randomY = centerY + (Math.random() - 0.5) * 100;
            
            animation.style.left = randomX + 'px';
            animation.style.top = randomY + 'px';
            
            gameScreen.appendChild(animation);
            
            // Remove animation after it completes
            setTimeout(() => {
                if (animation.parentNode) {
                    animation.parentNode.removeChild(animation);
                }
            }, 2000);
        }

        function showHeartAnimation() {
            // Create multiple hearts that persist across screens
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'answer-heart';
                    heart.textContent = '‚ô•';
                    heart.style.position = 'fixed';
                    heart.style.zIndex = '1003';
                    
                    // Position randomly around the screen
                    const randomX = Math.random() * window.innerWidth;
                    const randomY = Math.random() * window.innerHeight;
                    
                    heart.style.left = randomX + 'px';
                    heart.style.top = randomY + 'px';
                    
                    document.body.appendChild(heart);
                    
                    // Remove after animation
                    setTimeout(() => {
                        if (heart.parentNode) {
                            heart.parentNode.removeChild(heart);
                        }
                    }, 2000);
                }, i * 120);
            }
        }

        function showQuestionMarkAnimation() {
            // Clear any existing interval
            if (questionMarkInterval) {
                clearInterval(questionMarkInterval);
            }
            
            // Create initial batch of question marks and doubt emojis (like hearts on welcome screen)
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    createQuestionMarkElement();
                }, i * 120);
            }
            
            // Start continuous creation of falling elements (slower)
            questionMarkInterval = setInterval(() => {
                createQuestionMarkElement();
            }, 800); // Create new element every 800ms (slower)
        }
        
        function createQuestionMarkElement() {
            const element = document.createElement('div');
            element.className = 'question-mark-animation';
            
            // Randomly choose between question mark and doubt emoji
            const isDoubt = Math.random() < 0.5; // 50% chance for doubt emoji
            element.textContent = isDoubt ? 'ü§î' : '?';
            
            element.style.position = 'fixed';
            element.style.zIndex = '1003';
            
            // Position randomly around the screen (like hearts on welcome screen)
            const randomX = Math.random() * window.innerWidth;
            const randomY = Math.random() * window.innerHeight;
            
            element.style.left = randomX + 'px';
            element.style.top = randomY + 'px';
            
            document.body.appendChild(element);
            
            // Remove after animation (same duration as hearts)
            setTimeout(() => {
                if (element.parentNode) {
                    element.parentNode.removeChild(element);
                }
            }, 2000);
        }

        function showKissAnimation() {
            // Create multiple kisses that persist across screens
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const kiss = document.createElement('div');
                    kiss.className = 'kiss-animation';
                    kiss.textContent = 'üíã';
                    kiss.style.position = 'fixed';
                    kiss.style.zIndex = '1003';
                    
                    // Position randomly around the screen
                    const randomX = Math.random() * window.innerWidth;
                    const randomY = Math.random() * window.innerHeight;
                    
                    kiss.style.left = randomX + 'px';
                    kiss.style.top = randomY + 'px';
                    
                    document.body.appendChild(kiss);
                    
                    // Remove after animation
                    setTimeout(() => {
                        if (kiss.parentNode) {
                            kiss.parentNode.removeChild(kiss);
                        }
                    }, 2000);
                }, i * 120);
            }
        }

        function showMixedHeartAnimation() {
            // Create mixed hearts (regular and broken) that persist across screens
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    
                    // Randomly choose between regular heart and broken heart
                    const isBroken = Math.random() < 0.4; // 40% chance for broken heart
                    
                    if (isBroken) {
                        heart.className = 'answer-broken-heart';
                        heart.textContent = 'üíî';
                    } else {
                        heart.className = 'answer-heart';
                        heart.textContent = '‚ô•';
                    }
                    
                    heart.style.position = 'fixed';
                    heart.style.zIndex = '1003';
                    
                    // Position randomly around the screen
                    const randomX = Math.random() * window.innerWidth;
                    const randomY = Math.random() * window.innerHeight;
                    
                    heart.style.left = randomX + 'px';
                    heart.style.top = randomY + 'px';
                    
                    document.body.appendChild(heart);
                    
                    // Remove after animation
                    setTimeout(() => {
                        if (heart.parentNode) {
                            heart.parentNode.removeChild(heart);
                        }
                    }, 2000);
                }, i * 120);
            }
        }

        function showStatsScreen() {
            // Stop heart animation
            if (window.heartInterval) {
                clearInterval(window.heartInterval);
            }
            
            // Stop text creation
            if (window.textInterval) {
                clearInterval(window.textInterval);
            }
            
            // Remove all existing hearts
            const hearts = document.querySelectorAll('.heart');
            hearts.forEach(heart => heart.remove());
            
            // Remove all victory texts
            const victoryTexts = document.querySelectorAll('.victory-text');
            victoryTexts.forEach(text => text.remove());
            
            // Calculate and display statistics
            displayPlayerStats();
            
            // Show statistics screen
            showScreen('stats');
        }

        function displayPlayerStats() {
            // Display player 1 stats
            const player1Photo = document.getElementById('player1StatPhoto');
            const player1Name = document.getElementById('player1StatName');
            const player1Percentage = document.getElementById('player1StatPercentage');
            const player1Details = document.getElementById('player1StatDetails');
            
            // Display player 2 stats
            const player2Photo = document.getElementById('player2StatPhoto');
            const player2Name = document.getElementById('player2StatName');
            const player2Percentage = document.getElementById('player2StatPercentage');
            const player2Details = document.getElementById('player2StatDetails');
            
            // Calculate percentages
            const player1Percent = playerStats.player1.total > 0 ? 
                Math.round((playerStats.player1.correct / playerStats.player1.total) * 100) : 0;
            const player2Percent = playerStats.player2.total > 0 ? 
                Math.round((playerStats.player2.correct / playerStats.player2.total) * 100) : 0;
            
            // Set player 1 data
            if (uploadedPhotos.photo1) {
                const reader1 = new FileReader();
                reader1.onload = function(e) {
                    player1Photo.src = e.target.result;
                };
                reader1.readAsDataURL(uploadedPhotos.photo1);
            }
            player1Name.textContent = playerStats.player1.name;
            player1Percentage.textContent = `${player1Percent}%`;
            player1Details.textContent = `${playerStats.player1.correct} –∏–∑ ${playerStats.player1.total} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö`;
            
            // Set player 2 data
            if (uploadedPhotos.photo2) {
                const reader2 = new FileReader();
                reader2.onload = function(e) {
                    player2Photo.src = e.target.result;
                };
                reader2.readAsDataURL(uploadedPhotos.photo2);
            }
            player2Name.textContent = playerStats.player2.name;
            player2Percentage.textContent = `${player2Percent}%`;
            player2Details.textContent = `${playerStats.player2.correct} –∏–∑ ${playerStats.player2.total} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö`;
        }

        function restartFromBeginning() {
            // Reset game state
            currentDistance = 20;
            uploadedPhotos = { photo1: null, photo2: null };
            fighterNames = { name1: '', name2: '' };
            currentQuestionIndex = 0;
            
            // Reset player stats
            playerStats.player1 = { correct: 0, total: 0, name: '' };
            playerStats.player2 = { correct: 0, total: 0, name: '' };
            
            // Clear uploaded photos and names
            document.getElementById('fighter1').value = '';
            document.getElementById('fighter2').value = '';
            document.getElementById('name1').value = '';
            document.getElementById('name2').value = '';
            
            // Hide all photos
            document.getElementById('person1').style.display = 'none';
            document.getElementById('person2').style.display = 'none';
            
            // Stop any animations
            if (window.heartInterval) {
                clearInterval(window.heartInterval);
            }
            if (window.textInterval) {
                clearInterval(window.textInterval);
            }
            
            // Remove all victory elements
            const hearts = document.querySelectorAll('.heart');
            hearts.forEach(heart => heart.remove());
            const victoryTexts = document.querySelectorAll('.victory-text');
            victoryTexts.forEach(text => text.remove());
            
            // Go back to welcome screen
            showScreen('welcome');
        }

        // Override the old checkPhotosReady function
        function checkPhotosReady() {
            checkFightersReady();
        }

        // Initialize the page
        window.addEventListener('load', async function() {
            showScreen('welcome');
            await initializeFaceDetection();
            // Initialize dot positions
            updateDotPositions();
        });
    </script>
</body>
</html>
